<?php

$(macro :unsafe) {
    __iterator_aggregate_methods()
} >> {
    public function getIterator(): \Traversable
    {
        $elementCount = $this->elementCount;
        $clone = clone $this;
        for ($getIteratorIndex = 0; $getIteratorIndex < $elementCount; ++$getIteratorIndex) {
            $$(expand(
                $$(expand(__get_value($clone, primary, $getIteratorIndex, $result)))
            ));
            yield $getIteratorIndex => $result;
        }
    }
}